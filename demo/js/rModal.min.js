/*! rModal - v0.1.0 - 2016-01-18
* https://github.com/SubZane/flyPanels
* Copyright (c) 2016 Andreas Norman; Licensed MIT */
var rModal=function(){var a,b=document.documentElement.clientHeight,c={element:null,name:"",isFed:!1,ajaxdataurl:""},d={transitiontime:300,redrawOnResize:!0,logerrors:!1},e=function(e){options=k(d,e||{}),document.querySelector("body").innerHTML+='<div class="rModal-overlay"></div>',a=document.querySelector(".rModal-overlay");var f=document.querySelectorAll(".rModal");l(f,function(a,c){a.addEventListener("touchmove",function(c){a.scrollHeight<=parseInt(b,10)&&c.preventDefault()})});var m=document.querySelectorAll("[data-rmodal]");l(m,function(a,b){a.addEventListener("click",function(b){if(b.preventDefault(),c.name=a.getAttribute("data-rmodal"),c.element=document.querySelector("#rModal_"+c.name),c.element.hasAttribute("data-modaldata")?(c.isFed=!0,c.ajaxdataurl=c.element.getAttribute("data-modaldata")):c.isFed=!1,"click touchmove touchend touchleave touchcancel".split(" ").forEach(function(a){c.element.addEventListener(a,function(a){a.target===this&&j()})}),options.redrawOnResize===!0){var d;clearTimeout(d),d=setTimeout(g,100)}window.addEventListener("orientationchange",function(){h()}),i()})})},f=function(){var a=new XMLHttpRequest;a.open("GET",c.ajaxdataurl,!0),a.onload=function(){if(a.status>=200&&a.status<400){var b=JSON.parse(a.response),d=b.content;c.element.querySelector(".rModal").innerHTML+='<div class="content">'+d+"</div>"}else options.logerrors&&console.log("An error occured when trying to load data from "+c.ajaxdataurl)},a.onerror=function(){options.logerrors&&console.log("A connection error occured when trying to access "+c.ajaxdataurl)},a.send()},g=function(){b=window.innerHeight,h()},h=function(){c.element.style.height=b},i=function(){h(c.name),document.querySelector("body").classList.add("rModal-locked"),document.querySelector("html").classList.add("rModal-locked"),a.classList.add("fadein"),c.isFed&&f(),c.element.classList.add("rModal-active"),c.element.querySelector(".rModal-closebutton").addEventListener("click",function(a){a.preventDefault(),j()})},j=function(){c.element.classList.add("rModal-inactive"),a.classList.add("fadeout"),setTimeout(function(){c.element.classList.remove("rModal-active"),c.element.classList.remove("rModal-inactive"),a.classList.remove("fadein"),a.classList.remove("fadeout"),document.querySelector("body").classList.remove("rModal-locked"),document.querySelector("html").classList.remove("rModal-locked"),c.isFed&&c.element.querySelector(".rModal .content").remove()},options.transitiontime)},k=function(a,b){var c={};return l(a,function(b,d){c[d]=a[d]}),l(b,function(a,d){c[d]=b[d]}),c},l=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)};return{init:e}}();